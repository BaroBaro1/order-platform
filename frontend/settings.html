<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ§Ø¬Ø±</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f9;
  direction:rtl;
}

/* ===== Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù…ÙˆØ­Ù‘Ø¯ Ù…Ø¹ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯) ===== */
.navbar {
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 30px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.right-side{
  display:flex;
  align-items:center;
  gap:10px;
}

.store-img{
  width:45px;
  height:45px;
  border-radius:50%;
  object-fit:cover;
  border:1px solid #ddd;
}

#welcomeText{
  font-weight:bold;
  color:#333;
}

.left-side{
  display:flex;
  align-items:center;
  gap:15px;
}
.notifications{
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
  cursor:pointer;
}
.notification-wrapper{
  position: relative;
  display: inline-block;
}

.badge{
  position:absolute;
  top:-5px;
  right:-5px;
  background:red;
  color:white;
  font-size:12px;
  width:18px;
  height:18px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

.logout{
  text-decoration:none;
  color:#ff3366;
  font-weight:bold;
}

.logo{
  font-size:22px;
  font-weight:bold;
  color:#ff3366;
}

/* ===== Ø§Ù„ØªØ®Ø·ÙŠØ· ===== */
.layout{
  display:flex;
}

/* ===== Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± ===== */
.sidebar{
  width:230px;
  background:#cbced2;
  min-height:100vh;
  padding-top:20px;
}

.sidebar a{
  display:block;
  color:black;
  text-decoration:none;
  padding:12px 20px;
  margin:5px 10px;
  border-radius:8px;
}

.sidebar a:hover{
  background:#adadab;
}

.sidebar a.active{
  background:#adadab;
  font-weight:bold;
}

/* ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== */
.main{
  flex:1;
  padding:25px;
}

/* ===== Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===== */
.settings-grid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:20px;
}

.card{
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

/* ===== ØµÙˆØ±Ø© Ø§Ù„Ù…ØªØ¬Ø± ===== */
.store-photo{
  text-align:center;
  margin-bottom:15px;
}

.store-photo img{
  width:90px;
  height:90px;
  border-radius:50%;
  border:1px solid #ddd;
  margin-bottom:8px;
}

/* ===== Ø§Ù„Ø­Ù‚ÙˆÙ„ ===== */
.input-group{
  margin-bottom:12px;
}

.input-group label{
  display:block;
  font-weight:bold;
  margin-bottom:5px;
}

.input-group input, 
.input-group textarea{
  width:100%;
  padding:8px;
  border-radius:5px;
  border:1px solid #ccc;
  background:#f9f9f9;
}



/* ===== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
.btn-row{
  margin-top:20px;
  text-align:right;
}

button{
  padding:10px 15px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}

.edit-btn{
  background:#007bff;
  color:white;
}

.save-btn{
  background:#28a745;
  color:white;
}

/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #222;
  color: white;
  text-align: center;
  padding: 20px;
  margin-top: 40px;
}

footer a {
  color: #ffd000;
  text-decoration: none;
  margin: 0 10px;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div class="navbar">
  <div class="right-side">
    <img id="storeImg" src="https://via.placeholder.com/55" class="store-img">
    <span id="welcomeText">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„ØªØ§Ø¬Ø±</span>
  </div>

  <div class="left-side">
    <div class="notification-wrapper">
      <a href="notifications.html" class="notifications">ğŸ””</a>
      <span id="notifBadge" class="badge" style="display:none;">0</span>
    </div>
    <a class="logout" href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    <div class="logo">Baro</div>
  </div>
</div>

<!-- ===== LAYOUT ===== -->
<div class="layout">

<!-- SIDEBAR -->
<div class="sidebar">
  <a href="dashboard.html">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  <a href="allorders.html">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
  <a href="settings.html" class="active">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
  <a href="addProduct.html">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
</div>

<!-- ===== MAIN (ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯ + Ø§Ø­ØªØ±Ø§ÙÙŠ + Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø¨Ø§Ùƒâ€ŒØ§Ù†Ø¯) ===== -->
<div class="main">

<h2 style="margin-bottom:10px;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h2>
<p style="color:#666;margin-bottom:20px;">
ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ¬Ø±ÙƒØŒ Ø§Ù„ØµÙˆØ±Ø©ØŒ ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø«Ù… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.
</p>

<!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø«Ø§Ø¨Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
<div style="
background:#fff;
padding:12px;
border-radius:10px;
box-shadow:0 2px 8px rgba(0,0,0,.08);
margin-bottom:20px;
display:flex;
justify-content:space-between;
align-items:center;
position:sticky;
top:10px;
z-index:10;
">
  <strong>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</strong>

  <div>
    <button class="edit-btn" id="editBtn">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
    <button class="save-btn" id="saveBtn" style="display:none;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
  </div>
</div>

<div class="settings-grid">

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ© Ù„Ù„Ù…ØªØ¬Ø± -->
<div class="card">
  <h3>ğŸ–¼ï¸ ØµÙˆØ±Ø© Ø§Ù„Ù…ØªØ¬Ø±</h3>

  <div class="store-photo">
    <img id="previewImg" src="https://via.placeholder.com/90">
  </div>

  <input type="file" id="storeImageInput" accept="image/*">
  <p style="color:#666;font-size:13px;">
    ÙŠÙØ¶Ù‘Ù„ Ù…Ù‚Ø§Ø³ 400Ã—400 â€” Ø³ØªÙØ­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª".
  </p>
</div>

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
<div class="card">
  <h3>ğŸ“¦ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>

  <div class="input-group">
    <label>Ø§Ø³Ù… Ø§Ù„ØªØ§Ø¬Ø±</label>
    <input id="name" >
  </div>

  <div class="input-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
    <input id="storePhone" >
  </div>

  <div class="input-group">
    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input id="storeEmail" >
  </div>
</div>

<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ -->
<div class="card">
  <h3>ğŸ” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h3>

  <div class="input-group">
    <label>Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
    <input id="storeName" >
  </div>

  <button id="showPassBtn" style="margin-top:10px;">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>

  <div id="passwordBox" style="display:none; margin-top:10px;">
    <div class="input-group">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
      <input type="password" id="password">
    </div>

    <div class="input-group">
      <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input type="password" id="confirmPassword">
    </div>
  </div>
</div>

</div>

<!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
<p id="status" style="margin-top:15px;"></p>

</div>
</div>
<footer>
  <p>
    <a href="#">Ù…Ù† Ù†Ø­Ù†</a> |
    <a href="#">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
  </p>
  <p>Â© 2026 Baro - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script>
const merchantId = localStorage.getItem("merchantId") || 1;

/* ===== Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© ===== */
document.getElementById("storeImageInput").addEventListener("change", (e)=>{
  const file = e.target.files[0];
  if(file){
    document.getElementById("previewImg").src = URL.createObjectURL(file);
  }
});

/* ===== Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ===== */
document.getElementById("showPassBtn").addEventListener("click", ()=>{
  document.getElementById("passwordBox").style.display = "block";
});

/* ===== Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± ===== */
function loadMerchantData(){
  fetch(`http://localhost:3000/merchants/${merchantId}`)
  .then(res => res.json())
  .then(merchant => {

    document.getElementById("welcomeText").textContent =
      "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ " + (merchant.name || "Ø§Ù„ØªØ§Ø¬Ø±");

    if(merchant.storeImage){
      document.getElementById("storeImg").src =
        "http://localhost:3000" + merchant.storeImage;

      document.getElementById("previewImg").src =
        "http://localhost:3000" + merchant.storeImage;
    }

    document.getElementById("name").value = merchant.name || "";
    document.getElementById("storePhone").value = merchant.phone || "";
    document.getElementById("storeEmail").value = merchant.email || "";
    document.getElementById("storeName").value = merchant.storeName || "";
  });
}

/* ===== ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ===== */
const editBtn = document.getElementById("editBtn");
const saveBtn = document.getElementById("saveBtn");

editBtn.addEventListener("click", ()=>{
  document.querySelectorAll(".readonly").forEach(el=>{
    el.removeAttribute("readonly");
    el.style.background="#fff";
  });

  editBtn.style.display="none";
  saveBtn.style.display="inline-block";
});

/* ===== Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ===== */
saveBtn.addEventListener("click", async ()=>{

  const pass = document.getElementById("password").value;
  const confirmPass = document.getElementById("confirmPassword").value;

  if(pass && pass !== confirmPass){
    document.getElementById("status").textContent =
      "âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©";
    return;
  }

  // ===== Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª =====
  const fileInput = document.getElementById("storeImageInput");

  if (fileInput.files.length > 0) {
    const formData = new FormData();
    formData.append("image", fileInput.files[0]);

    await fetch(`http://localhost:3000/merchants/${merchantId}/upload-image`, {
      method: "POST",
      body: formData
    });
  }

  // ===== Ø­ÙØ¸ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====
  const data = {
    name: document.getElementById("name").value,
    phone: document.getElementById("storePhone").value,
    email: document.getElementById("storeEmail").value,
    storeName: document.getElementById("storeName").value,
  };

  const res = await fetch(
    `http://localhost:3000/merchants/${merchantId}`,
    {
      method:"PUT",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify(data)
    }
  );

  // ===== ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù† ÙˆÙØ¬Ø¯Øª =====
  if (pass) {
    await fetch(
      `http://localhost:3000/merchants/${merchantId}/password`,
      {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ newPassword: pass })
      }
    );
  }

  // Ø¥Ø°Ø§ ÙˆØµÙ„Ù†Ø§ Ù‡Ù†Ø§ = ÙƒÙ„ Ø´ÙŠØ¡ Ù†Ø¬Ø­
  document.getElementById("status").textContent =
    "ØªÙ… Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…";

  document.querySelectorAll(".readonly").forEach(el=>{
    el.setAttribute("readonly", true);
    el.style.background="#eee";
  });

  saveBtn.style.display="none";
  editBtn.style.display="inline-block";

});


/* ===== Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
fetch(`http://localhost:3000/merchants/${merchantId}/notifications`)
.then(res => res.json())
.then(notifs => {
  const unread = notifs.filter(n => !n.isRead).length;
  const badge = document.getElementById("notifBadge");

  if(unread > 0){
    badge.style.display = "flex";
    badge.textContent = unread;
  } else {
    badge.style.display = "none";
  }
});

loadMerchantData();
</script>
</body>
</html>
