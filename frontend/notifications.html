<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f9;
  direction:rtl;
}

/* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± ========== */
.navbar {
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 30px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.right-side{
  display:flex;
  align-items:center;
  gap:10px;
}

.store-img{
  width:45px;
  height:45px;
  border-radius:50%;
  object-fit:cover;
  border:1px solid #ddd;
}

#welcomeText{
  font-weight:bold;
  color:#333;
}

.left-side{
  display:flex;
  align-items:center;
  gap:15px;
}

.notifications{
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
  cursor:pointer;
}
/* ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
.notification-wrapper{
  position: relative;
  display: inline-block;
}

.badge{
  position:absolute;
  top:-5px;
  right:-5px;
  background:red;
  color:white;
  font-size:12px;
  width:18px;
  height:18px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

.logout{
  text-decoration:none;
  color:#ff3366;
  font-weight:bold;
}

.logo{
  font-size:22px;
  font-weight:bold;
  color:#ff3366;
}

/* ========== Ø§Ù„ØªØ®Ø·ÙŠØ· ========== */
.layout{
  display:flex;
}

/* ========== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ========== */
.sidebar{
  width:230px;
  background:#e5e7eb;
  min-height:100vh;
  padding-top:20px;
}

.sidebar a{
  display:block;
  color:#111;
  text-decoration:none;
  padding:12px 20px;
  margin:5px 10px;
  border-radius:8px;
}

.sidebar a:hover{
  background:#cfd2d6;
}

/* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ========== */
.main{
  flex:1;
  padding:25px;
}

.container{
  max-width: 900px;
  margin: 0 auto;
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}

/* ===== Ø±Ø£Ø³ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
.header-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}

.mark-all{
  background:#007bff;
  color:white;
  border:none;
  padding:8px 12px;
  border-radius:6px;
  cursor:pointer;
}

/* ===== Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ===== */
.notification{
  display:flex;
  align-items:center;
  gap:15px;
  padding:12px;
  border-bottom:1px solid #ddd;
}

.icon{
  font-size:24px;
}

.content{
  flex:1;
}

.time{
  color:#777;
  font-size:13px;
}

/* Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
.new{
  background:#eef6ff;
}

.read{
  background:white;
}

/* Ø²Ø± Ù‚Ø±Ø§Ø¡Ø© */
.read-btn{
  background:#28a745;
  color:white;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}

/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #222;
  color: white;
  text-align: center;
  padding: 20px;
  margin-top: 40px;
}

footer a {
  color: #ffd000;
  text-decoration: none;
  margin: 0 10px;
}
</style>
</head>

<body>

<!-- ========== HEADER ========== -->
<div class="navbar">
  <div class="right-side">
    <img id="storeImg"
         src="https://via.placeholder.com/45"
         class="store-img">
    <span id="welcomeText">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„ØªØ§Ø¬Ø±</span>
  </div>

  <div class="left-side">
<div class="notification-wrapper">
  <a class="notifications" href="notifications.html">ğŸ””</a>
  <span id="notifBadge" class="badge" style="display:none;">0</span>
</div>  
    <a class="logout" href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    <div class="logo">Baro</div>
  </div>
</div>

<div class="layout">

<!-- ===== SIDEBAR ===== -->
<div class="sidebar">
  <a href="dashboard.html">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  <a href="allorders.html">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
  <a href="settings.html">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
  <a href="addProduct.html">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
</div>
<!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ===== -->
<div class="main">
<div class="container">

<div class="header-row">
  <h2>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
  <button class="mark-all" onclick="markAllRead()">
    ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡
  </button>
</div>

<div id="notificationsList">

  <!-- Ù…Ø«Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± 1 -->
  <div class="notification new" data-id="1">
    <div class="icon">ğŸ›’</div>
    <div class="content">
      <b>Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</b><br>
      Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ "Ù‡Ø§ØªÙ Ø³Ø§Ù…Ø³ÙˆÙ†Øº"
      <div class="time">Ù…Ù†Ø° 5 Ø¯Ù‚Ø§Ø¦Ù‚</div>
    </div>
    <button class="read-btn" onclick="markRead(1)">Ù…Ù‚Ø±ÙˆØ¡</button>
  </div>

  <!-- Ù…Ø«Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± 2 -->
  <div class="notification new" data-id="2">
    <div class="icon">ğŸ“¦</div>
    <div class="content">
      <b>Ø·Ù„Ø¨ Ù…ÙƒØªÙ…Ù„</b><br>
      ØªÙ… ØªØ³Ù„ÙŠÙ… Ø·Ù„Ø¨ Ø±Ù‚Ù… #12 Ø¨Ù†Ø¬Ø§Ø­
      <div class="time">Ù…Ù†Ø° 30 Ø¯Ù‚ÙŠÙ‚Ø©</div>
    </div>
    <button class="read-btn" onclick="markRead(2)">Ù…Ù‚Ø±ÙˆØ¡</button>
  </div>

  <!-- Ù…Ø«Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± 3 -->
  <div class="notification read" data-id="3">
    <div class="icon">âš™ï¸</div>
    <div class="content">
      <b>ØªØ­Ø¯ÙŠØ« Ø­Ø³Ø§Ø¨</b><br>
      ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ù…ØªØ¬Ø±Ùƒ Ø¨Ù†Ø¬Ø§Ø­
      <div class="time">Ø£Ù…Ø³</div>
    </div>
  </div>

</div>

</div>
</div>
</div>

<footer>
  <p>
    <a href="#">Ù…Ù† Ù†Ø­Ù†</a> |
    <a href="#">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
  </p>
  <p>Â© 2026 Baro - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script>
const merchantId = localStorage.getItem("merchantId");
const token = localStorage.getItem("token");

if (!merchantId || !token) {
  alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  window.location = "login.html";
}

// ===== Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± (Ù„Ù„Ø§Ø³Ù… + Ø§Ù„ØµÙˆØ±Ø©) =====
fetch(`http://localhost:3000/merchants/${merchantId}`, {
  headers: { 
    "Authorization": `Bearer ${token}`,
    "Content-Type": "application/json"
  }
})
.then(r => r.json())
.then(m => {
  document.getElementById("welcomeText").textContent =
    "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ " + (m.name || "Ø§Ù„ØªØ§Ø¬Ø±");

  if(m.storeImage){
    document.getElementById("storeImg").src =
      "http://localhost:3000" + m.storeImage;
  }
});

// ===== Ø¯Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¯Ø§Ø¦Ù…Ù‹Ø§) =====
function loadNotifications(){
  fetch(`http://localhost:3000/merchants/${merchantId}/notifications`, {
    headers: { "Authorization": `Bearer ${token}` }
  })
  .then(res => res.json())
  .then(notifications => {
    const list = document.getElementById("notificationsList");
    list.innerHTML = "";

    if(notifications.length === 0){
      list.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
      document.getElementById("notifBadge").style.display = "none";
      return;
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¬Ø±Ø³
    const unread = notifications.filter(n => !n.isRead).length;
    const badge = document.getElementById("notifBadge");

    if(unread > 0){
      badge.style.display = "flex";
      badge.textContent = unread;
    } else {
      badge.style.display = "none";
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    notifications.forEach(n => {
      const div = document.createElement("div");
      div.className = `notification ${n.isRead ? "read" : "new"}`;
      div.dataset.id = n.id;

      div.innerHTML = `
        <div class="icon">
          ${n.type === "new_order" ? "ğŸ›’" :
            n.type === "order_done" ? "ğŸ“¦" : "ğŸ””"}
        </div>

        <div class="content">
          <b>${n.type === "new_order" ? "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯" : "Ø¥Ø´Ø¹Ø§Ø±"}</b><br>
          ${n.message}
          <div class="time">
            ${new Date(n.createdAt).toLocaleString("ar-DZ")}
          </div>
        </div>

        ${n.isRead ? "" :
          `<button class="read-btn" onclick="markRead(${n.id})">
             Ù…Ù‚Ø±ÙˆØ¡
           </button>`}
      `;

      list.appendChild(div);
    });
  })
  .catch(err => console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:", err));
}

// ===== ØªØ­Ø¯ÙŠØ¯ Ø¥Ø´Ø¹Ø§Ø± ÙƒÙ…Ù‚Ø±ÙˆØ¡ ======
function markRead(id){
  fetch(`http://localhost:3000/notifications/${id}/read`, {
    method: "PATCH",
    headers: { "Authorization": `Bearer ${token}` }
  })
  .then(res => res.json())
  .then(() => {
    loadNotifications(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
  });
}

// ===== ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡ ======
function markAllRead(){
  fetch(`http://localhost:3000/merchants/${merchantId}/notifications/read-all`, {
    method: "PATCH",
    headers: { "Authorization": `Bearer ${token}` }
  })
  .then(res => res.json())
  .then(() => {
    loadNotifications(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
  });
}

// ===== ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© =====
loadNotifications();
</script>

</body>
</html>
