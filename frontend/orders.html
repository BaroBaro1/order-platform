<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</title>
  <style>
    body {
      background:#f4f4f9;
      font-family: Arial, sans-serif;
        margin:0;
      direction:rtl;
    }

/* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù†ÙØ³ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯) ========== */
.navbar {
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 30px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.right-side{
  display:flex;
  align-items:center;
  gap:10px;
}

.store-img{
  width:45px;
  height:45px;
  border-radius:50%;
  object-fit:cover;
  border:1px solid #ddd;
}

#welcomeText{
  font-weight:bold;
  color:#333;
}

.left-side{
  display:flex;
  align-items:center;
  gap:15px;
}

.notifications{
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
  cursor:pointer;
}

/* ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
.notification-wrapper{
  position: relative;
  display: inline-block;
}

.badge{
  position:absolute;
  top:-5px;
  right:-5px;
  background:red;
  color:white;
  font-size:12px;
  width:18px;
  height:18px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

.logout{
  text-decoration:none;
  color:#ff3366;
  font-weight:bold;
}

.logo{
  font-size:22px;
  font-weight:bold;
  color:#ff3366;
}

/* ========== ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© ========== */
.layout{
  display:flex;
}

/* ========== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ========== */
.sidebar{
  width:230px;
  background:#cbced2;
  min-height:100vh;
  padding-top:20px;
}

.sidebar a{
  display:block;
  color:rgb(14, 12, 12);
  text-decoration:none;
  padding:12px 20px;
  margin:5px 10px;
  border-radius:8px;
}

.sidebar a:hover{
  background:#adadab;
}

/* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
.main{
  flex:1;
  padding:25px;
}
 .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,.1);
 }

    h2 { text-align:center; margin-bottom:20px; }

    table {
      width:100%;
      border-collapse: collapse;
      margin-top:20px;
    }

    th, td {
      border:1px solid #ddd;
      padding:10px;
      text-align:center;
    }

    th {
      background:#007bff;
      color:white;
    }

    .status {
      padding:5px 10px;
      border-radius:5px;
      color:white;
    }

    .pending { background:#ffc107; color:black; }
    .done { background:#28a745; }

    .back {
      display:inline-block;
      margin-bottom:15px;
      text-decoration:none;
      background:#333;
      color:white;
      padding:8px 12px;
      border-radius:5px;
    }

    #empty {
      text-align:center;
      margin-top:20px;
      color:#777;
    }
    .canceled {
  background: #dc3545;
}
/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #222;
  color: white;
  text-align: center;
  padding: 20px;
  margin-top: 40px;
}

footer a {
  color: #ffd000;
  text-decoration: none;
  margin: 0 10px;
}
  </style>
</head>

<body>

<!-- ========== HEADER ========== -->
<div class="navbar">

  <div class="right-side">
    <img id="storeImg"
         src="https://via.placeholder.com/45"
         class="store-img">
    <span id="welcomeText">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„ØªØ§Ø¬Ø±</span>
  </div>

  <div class="left-side">
    <div class="notification-wrapper">
      <a class="notifications" href="notifications.html">ğŸ””</a>
      <span id="notifBadge" class="badge" style="display:none;">0</span>
    </div>

    <a class="logout" href="login.html"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    <div class="logo">Baro</div>
  </div>

</div>

<!-- ========== ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© ========== -->
<div class="layout">

  <!-- ===== SIDEBAR ===== -->
  <div class="sidebar">
    <a href="dashboard.html">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <a href="allorders.html">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
    <a href="settings.html">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
    <a href="addProduct.html" class="active">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
  </div>
   <!-- MAIN -->
  <div class="main">
  <!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== -->
<div class="container">

  <a class="back" href="dashboard.html">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ§Ø¬Ø±</a>

  <h2>ğŸ“¦ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</h2>

  <table>
    <thead>
  <tr>
    <th>ID Ø§Ù„Ø·Ù„Ø¨</th>
    <th>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</th>
    <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
    <th>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</th>
    <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
  </tr>
</thead>

    <tbody id="ordersBody"></tbody>
  </table>

  <p id="empty"></p>
</div>
  </div></div>
<script>
const ordersBody = document.getElementById("ordersBody");
const emptyMsg = document.getElementById("empty");

// Ù‚Ø±Ø§Ø¡Ø© productId Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
const params = new URLSearchParams(window.location.search);
const productId = params.get('productId');

if (!productId) {
  emptyMsg.textContent = "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†ØªØ¬!";
  throw new Error("Product ID missing in URL");
}

// Ø±Ù‚Ù… Ø§Ù„ØªØ§Ø¬Ø±
const merchantId = 1;

// Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØ§Ø¬Ø±
fetch(`http://localhost:3000/merchants/${merchantId}/orders`)
  .then(res => res.json())
  .then(data => {
    console.log("Orders from API:", data);

    // ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ù†ØªØ¬ ÙÙ‚Ø·
    const filteredOrders = data.filter(order => order.product.id == productId);

    if (filteredOrders.length === 0) {
      emptyMsg.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ø­Ø§Ù„ÙŠØ§Ù‹";
      return;
    }

    filteredOrders.forEach(order => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
  <td>${order.id}</td>
  <td>${order.customerName}</td>
  <td>${order.customerPhone}</td>
  <td>${order.wilaya}</td>
  <td>${order.totalPrice} Ø¯Ø¬</td>
  <td id="status-${order.id}" 
      class="status ${order.status === 'done' ? 'done' : 'pending'}">
    ${order.status === 'done' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù…Ø¹Ù„Ù‚'}
  </td>
  <td>
    <button onclick="updateStatus(${order.id}, 'done')">âœ… ØªØ£ÙƒÙŠØ¯</button>
    <button onclick="updateStatus(${order.id}, 'canceled')">âŒ Ø¥Ù„ØºØ§Ø¡</button>
  </td>
`;
      ordersBody.appendChild(tr);
    });
  })
  .catch(err => {
    console.error("Error:", err);
    emptyMsg.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª";
  });
  function updateStatus(orderId, newStatus) {
  fetch(`http://localhost:3000/orders/${orderId}`, {
    method: "PATCH",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status: newStatus })
  })
  .then(res => res.json())
  .then(updatedOrder => {
    console.log("Updated:", updatedOrder);

    const statusCell = document.getElementById(`status-${orderId}`);

    if (newStatus === "done") {
      statusCell.textContent = "Ù…ÙƒØªÙ…Ù„";
      statusCell.className = "status done";
    } else {
      statusCell.textContent = "Ù…Ù„ØºÙ‰";
      statusCell.className = "status canceled";
    }
  })
  .catch(err => console.error("Update error:", err));
}

// ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª =====
fetch(`http://localhost:3000/merchants/${merchantId}/notifications`)
.then(res => res.json())
.then(notifs => {
  const unread = notifs.filter(n => !n.isRead).length;
  const badge = document.getElementById("notifBadge");

  if(unread > 0){
    badge.style.display = "flex";
    badge.textContent = unread;
  } else {
    badge.style.display = "none";
  }
});

</script>
<footer>
  <p>
    <a href="#">Ù…Ù† Ù†Ø­Ù†</a> |
    <a href="#">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
  </p>
  <p>Â© 2026 Baro - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>
</body>
</html>
