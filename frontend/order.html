<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تأكيد الطلب</title>
  <style>
    /* ----------------- Reset ----------------- */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

    body {
      background: #f4f4f9;
      padding: 20px;
      display: flex;
      justify-content: center;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      padding: 20px;
    }

    h2 { text-align: center; margin-bottom: 20px; color: #333; }

    .product {
      text-align: center;
      margin-bottom: 30px;
    }

    .product img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
      height: auto;
    }

    .product h3 { font-size: 24px; margin-bottom: 5px; color: #007bff; }
    .product p { font-size: 18px; color: #555; }

    form label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }

    form input, form select, form textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
    }

    form textarea { resize: vertical; }

    button {
      width: 100%;
      padding: 12px;
      margin-top: 20px;
      background-color: #007bff;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover { background-color: #0056b3; }

    #result {
      margin-top: 20px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }

    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>

  <div class="container">
    <h2>تأكيد الطلب</h2>

    <div class="product">
      <img id="productImage" src="https://via.placeholder.com/400x300?text=جارٍ+تحميل+الصورة" alt="صورة المنتج" />
      <h3 id="productName">جاري التحميل...</h3>
      <p>السعر: <span id="price"></span> دج</p>
    </div>

    <form id="orderForm">
      <input type="hidden" id="productId" name="productId" />

      <label>الاسم واللقب</label>
      <input type="text" id="customerName" name="customerName" required />

      <label>الهاتف</label>
      <input type="text" id="customerPhone" name="customerPhone" required />

      <label>الولاية</label>
      <select id="wilaya" name="wilaya" required>
        <option value="">اختر الولاية</option>
        <option value="ادرار">ادرار</option>
        <option value="الشلف">الشلف</option>
        <option value="الأغواط">الأغواط</option>
        <option value="ام البواقي">ام البواقي</option>
        <option value="باتنة">باتنة</option>
        <option value="بجاية">بجاية</option>
        <option value="بسكرة">بسكرة</option>
        <option value="بشار">بشار</option>
        <option value="البليدة">البليدة</option>
        <option value="البويرة">البويرة</option>
        <option value="تمنراست">تمنراست</option>
        <option value="تبسة">تبسة</option>
        <option value="تلمسان">تلمسان</option>
        <option value="تيارت">تيارت</option>
        <option value="تيزي وزو">تيزي وزو</option>
        <option value="الجزائر">الجزائر</option>
        <option value="الجلفة">الجلفة</option>
        <option value="جيجل">جيجل</option>
        <option value="سطيف">سطيف</option>
        <option value="سعيدة">سعيدة</option>
        <option value="سكيكدة">سكيكدة</option>
        <option value="سيدي بلعباس">سيدي بلعباس</option>
        <option value="عنابة">عنابة</option>
        <option value="قسنطينة">قسنطينة</option>
        <option value="المدية">المدية</option>
        <option value="مستغانم">مستغانم</option>
        <option value="المسيلة">المسيلة</option>
        <option value="معسكر">معسكر</option>
        <option value="ورقلة">ورقلة</option>
        <option value="وهران">وهران</option>
        <option value="البيض">البيض</option>
        <option value="إليزي">إليزي</option>
        <option value="برج بوعريريج">برج بوعريريج</option>
        <option value="بومرداس">بومرداس</option>
        <option value="الطارف">الطارف</option>
        <option value="تندوف">تندوف</option>
        <option value="تيسمسيلت">تيسمسيلت</option>
        <option value="وادي سوف">وادي سوف</option>
        <option value="خنشلة">خنشلة</option>
        <option value="سوق أهراس">سوق أهراس</option>
        <option value="تيبازة">تيبازة</option>
        <option value="ميلة">ميلة</option>
        <option value="عين الدفلى">عين الدفلى</option>
        <option value="النعامة">النعامة</option>
        <option value="عين تموشنت">عين تموشنت</option>
        <option value="غرداية">غرداية</option>
        <option value="غليزان">غليزان</option>
        <option value="تيميمون">تيميمون</option>
        <option value="برج باجي مختار">برج باجي مختار</option>
        <option value="ولاد جلال">ولاد جلال</option>
        <option value="بني عباس">بني عباس</option>
        <option value="عين صالح">عين صالح</option>
        <option value="عين قزام">عين قزام</option>
        <option value="تقرت">تقرت</option>
        <option value="جنات">جنات</option>
        <option value="المغير">المغير</option>
        <option value="المنيعة">المنيعة</option>
      </select>
        
        <!-- أضف المزيد من الولايات حسب الحاجة -->

      <label>البلدية</label>
      <select id="commune" name="commune" required>
        <option value="">اختر البلدية</option>
        <!-- سيتم ملء هذا الاختيار ديناميكيًا بناءً على الولاية المختارة -->
      </select>
      <label>العنوان</label>
      <textarea id="address" name="address" required></textarea>

      <label>طريقة التوصيل</label>
      <select id="deliveryType" name="deliveryType" required>
        <option value="الى المكتب">الى المكتب</option>
        <option value="الى المنزل">الى المنزل</option>
      </select>

      <label>سعر التوصيل</label>
      <input type="number" id="deliveryPrice" name="deliveryPrice" value="0" required />

      <button type="submit">تأكيد الطلب</button>
    </form>

    <p id="result"></p>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const link = urlParams.get("link");

    const productImage = document.getElementById("productImage");
    const productName = document.getElementById("productName");
    const priceEl = document.getElementById("price");
    const productIdEl = document.getElementById("productId");
    const resultEl = document.getElementById("result");

    // جلب بيانات المنتج من Backend
    fetch(`http://localhost:3000/order/${link}`)
      .then(res => res.json())
      .then(product => {
        if(product.error){
          productName.textContent = product.error;
          return;
        }

        productName.textContent = product.name;
        priceEl.textContent = product.price.toLocaleString();
        productIdEl.value = product.id;
        productImage.src = product.image ? `http://localhost:3000${product.image}` : 'https://via.placeholder.com/400x300?text=لا+يوجد+صورة';
      })
      .catch(err => {
        console.error(err);
        productName.textContent = "حدث خطأ في جلب المنتج";
      });

const communesByWilaya = {
  // جميع البلديات الجزائرية لكل ولاية
  "ادرار": ["ادرار", "تامست", "رقان", "تيميمون", "أولاد سعيد", "برج باجي مختار", "أقبلي", "أولاد أحمد تيمي", "زاوية كنتة", "تسابيت", "شروين", "فنوغيل", "تيمقتن", "سالي", "سبع", "أولف", "زاوية الدباغ", "أقبلي"],
  "الشلف": ["الشلف", "تنس", "بوقادير", "المرسى", "الشطية", "واد سلي", "أبو الحسن", "بني حواء", "الزبوجة", "تلعصة", "الهرانفة", "سيدي عكاشة", "سيدي عبد الرحمن", "بني راشد", "أولاد فارس", "أولاد بن عبد القادر", "بوزغاية", "الولجة"],
  "الأغواط": ["الأغواط", "قصر الحيران", "حاسي الدلاعة", "حاسي الرمل", "حاسي عبد الله", "بن ناصر بن شهرة", "عين ماضي", "تاجرونة", "أفلو", "سبقاق", "الغيشة", "تاويالة", "القلتة", "الخنق", "سيدي مخلوف", "العسافية", "المجبارة", "البيضاء", "الحويطة"],
  "أم البواقي": ["أم البواقي", "عين البيضاء", "عين مليلة", "عين فكرون", "عين الزيتون", "عين كرشة", "عين ببوش", "عين الديس", "بريش", "بئر الشهداء", "بئر رقعة", "العامرية", "الضلعة", "الحرملية", "سوق نعمان", "سيقوس", "هنشير تومغني"],
  "باتنة": ["باتنة", "أريس", "ثنية العابد", "مروانة", "عين التوتة", "المعذر", "سريانة", "بوزينة", "بريكة", "الجزار", "تكوت", "فم الطوب", "عين جاسر", "عين ياقوت", "أولاد سلام", "أولاد سي سليمان", "أولاد عمار", "أولاد فاضل", "أولاد عوف", "أولاد شليح", "أولاد سلام", "أولاد سي سليمان", "أولاد عمار", "أولاد فاضل", "أولاد عوف", "أولاد شليح"],
  "بجاية": ["بجاية", "أميزور", "أوقاس", "أقبو", "سوق الاثنين", "تيشي", "صدوق", "خراطة", "تازمالت", "شميني", "سيدي عيش", "تالة حمزة", "بني معوش", "بني جليل", "بني كسيلة", "بني مليكش", "بني شعيب", "بني دوالة", "بني معوش", "بني جليل", "بني كسيلة", "بني مليكش", "بني شعيب", "بني دوالة"],
  "بسكرة": ["بسكرة", "طولقة", "سيدي عقبة", "زريبة الوادي", "القنطرة", "ليوا", "أولاد جلال", "جميلة", "مشونش", "أورلال", "عين الناقة", "عين زعطوط", "عين الشهداء", "عين صالح", "عين قزام", "عين صالح", "عين قزام"],
  "بشار": ["بشار", "بني عباس", "تاغيت", "العبادلة", "كنادسة", "القنادسة", "الواتة", "بني ونيف", "بني يخلف", "بني ونيف", "بني يخلف"],
  "البليدة": ["البليدة", "بوفاريك", "العفرون", "الشفة", "مفتاح", "بوعينان", "الصومعة", "بني تامو", "بني مراد", "بني عمران", "بني تامو", "بني مراد", "بني عمران"],
  "البويرة": ["البويرة", "الأخضرية", "عين بسام", "سور الغزلان", "بئر غبالو", "بئر غبالو", "بئر غبالو"],
  "تمنراست": ["تمنراست", "عين صالح", "عين قزام", "تازروك", "تازروك", "تازروك"],
  "تبسة": ["تبسة", "العوينات", "بئر العاتر", "الشريعة", "الماء الأبيض", "بئر مقدم", "بئر مقدم", "بئر مقدم"],
  "تلمسان": ["تلمسان", "الرمشي", "الغزوات", "صبحة", "صبحة", "صبحة"],
  "تيارت": ["تيارت", "حمادية", "مهدية", "مهدية", "مهدية"],
  "تيزي وزو": ["تيزي وزو", "عزازقة", "ذراع بن خدة", "بني يني", "بني دوالة", "بني دوالة"],
  "الجزائر": ["باب الواد", "الحراش", "الدار البيضاء", "القصبة", "عين البنيان", "بئر مراد رايس", "بئر خادم", "بئر توتة", "بئر توتة"],
  "الجلفة": ["الجلفة", "عين الإبل", "عين وسارة", "حاسي بحبح", "حاسي العش", "حاسي العش"],
  "جيجل": ["جيجل", "الطاهير", "الميلية", "الميلية", "الميلية"],
  "سطيف": ["سطيف", "العلمة", "عين آزال", "بوقاعة", "عين ولمان", "عين ولمان"],
  "سعيدة": ["سعيدة", "أولاد إبراهيم", "أولاد خالد", "أولاد خالد"],
  "سكيكدة": ["سكيكدة", "عزابة", "الحروش", "الحروش"],
  "سيدي بلعباس": ["سيدي بلعباس", "سفيزف", "سفيزف"],
  "عنابة": ["عنابة", "الحجار", "برحال", "برحال"],
  "قالمة": ["قالمة", "بوشقوف", "بوشقوف"],
  "المدية": ["المدية", "برج الأمير عبد القادر", "برج الأمير عبد القادر"],
  "مستغانم": ["مستغانم", "عين تادلس", "عين تادلس"],
  "المسيلة": ["المسيلة", "بوسعادة", "بوسعادة"],
  "معسكر": ["معسكر", "غريس", "غريس"],
  "ورقلة": ["ورقلة", "تقرت", "تقرت"],
  "وهران": ["وهران", "بير الجير", "السانيـة", "قديل", "عين الترك", "بطيوة", "بطيوة"],
  "البيض": ["البيض", "بوقطب", "بوقطب"],
  "إليزي": ["إليزي", "الدبداب", "الدبداب"],
  "برج بوعريريج": ["برج بوعريريج", "برج زمورة", "برج زمورة"],
  "بومرداس": ["بومرداس", "الثنية", "الثنية"],
  "الطارف": ["الطارف", "بوثلجة", "بوثلجة"],
  "تندوف": ["تندوف", "أم العسل", "أم العسل"],
  "تيسمسيلت": ["تيسمسيلت", "ثنية الحد", "ثنية الحد"],
  "وادي سوف": ["الوادي", "قمار", "قمار"],
  "خنشلة": ["خنشلة", "أولاد رشاش", "أولاد رشاش"],
  "سوق أهراس": ["سوق أهراس", "سدراتة", "سدراتة"],
  "تيبازة": ["تيبازة", "شرشال", "شرشال"],
  "ميلة": ["ميلة", "فرجيوة", "فرجيوة"],
  "عين الدفلى": ["عين الدفلى", "العطاف", "العطاف"],
  "النعامة": ["النعامة", "مشرية", "مشرية"],
  "عين تموشنت": ["عين تموشنت", "حمام بوحجر", "حمام بوحجر"],
  "غرداية": ["غرداية", "بريان", "بريان"],
  "غليزان": ["غليزان", "وادي ارهيو", "وادي ارهيو"],
  "تيميمون": ["تيميمون", "أولاد سعيد", "أولاد سعيد"],
  "برج باجي مختار": ["برج باجي مختار", "تيمياوين", "تيمياوين"],
  "أولاد جلال": ["أولاد جلال", "سيدي خالد", "سيدي خالد"],
  "بني عباس": ["بني عباس", "كرزاز", "كرزاز"],
  "عين صالح": ["عين صالح", "فقارة الزوى", "فقارة الزوى"],
  "عين قزام": ["عين قزام", "تين زواتين", "تين زواتين"],
  "تقرت": ["تقرت", "تماسين", "تماسين"],
  "جانت": ["جانت", "برج الحواس", "برج الحواس"],
  "المغير": ["المغير", "سيدي خليل", "سيدي خليل"],
  "المنيعة": ["المنيعة", "حاسي القارة", "حاسي القارة"]
};

const wilayaSelect = document.getElementById("wilaya");
const communeSelect = document.getElementById("commune");

wilayaSelect.addEventListener("change", function () {
  const selectedWilaya = this.value;

  // تفريغ القائمة
  communeSelect.innerHTML = '<option value="">اختر البلدية</option>';

  if (!selectedWilaya || !communesByWilaya[selectedWilaya]) return;

  communesByWilaya[selectedWilaya].forEach(commune => {
    const option = document.createElement("option");
    option.value = commune;
    option.textContent = commune;
    communeSelect.appendChild(option);
  });
});


    // إرسال الطلب
    const form = document.getElementById("orderForm");
    form.addEventListener("submit", e => {
      e.preventDefault();

      const data = {
        productId: Number(productIdEl.value),
        customerName: document.getElementById("customerName").value,
        customerPhone: document.getElementById("customerPhone").value,
        wilaya: document.getElementById("wilaya").value,
        commune: document.getElementById("commune").value,
        address: document.getElementById("address").value,
        deliveryType: document.getElementById("deliveryType").value,
        deliveryPrice: Number(document.getElementById("deliveryPrice").value)
      };

      fetch("http://localhost:3000/orders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(resp => {
        if(resp.success){
          resultEl.textContent = "✅ تم تسجيل الطلب بنجاح";
          resultEl.className = "success";
          form.reset();
        } else {
          resultEl.textContent = "❌ حدث خطأ أثناء تسجيل الطلب";
          resultEl.className = "error";
        }
      })
      .catch(err => {
        console.error(err);
        resultEl.textContent = "❌ خطأ في الاتصال بالخادم";
        resultEl.className = "error";
      });
    });
  </script>

</body>
</html>
