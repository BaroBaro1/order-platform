<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f9;
  direction:rtl;
}

/* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù†ÙØ³Ù‡) ========== */
.navbar {
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 30px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.right-side{
  display:flex;
  align-items:center;
  gap:10px;
}

.store-img{
  width:45px;
  height:45px;
  border-radius:50%;
  object-fit:cover;
  border:1px solid #ddd;
}
#welcomeText{
  font-weight:bold;
  color:#333;
}
.left-side{
  display:flex;
  align-items:center;
  gap:15px;
}

.notifications{
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
  cursor:pointer;
}

/* ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
.notification-wrapper{
  position: relative;
  display: inline-block;
}

.badge{
  position:absolute;
  top:-5px;
  right:-5px;
  background:red;
  color:white;
  font-size:12px;
  width:18px;
  height:18px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

.logout{
  text-decoration:none;
  color:#ff3366;
  font-weight:bold;
}

.logo{
  font-size:22px;
  font-weight:bold;
  color:#ff3366;
}

/* ========== ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© ========== */
.layout{
  display:flex;
}

/* ========== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ========== */
.sidebar{
  width:230px;
  background:#cbced2;
  min-height:100vh;
  padding-top:20px;
}

.sidebar a{
  display:block;
  color:black;
  text-decoration:none;
  padding:12px 20px;
  margin:5px 10px;
  border-radius:8px;
}

.sidebar a:hover{
  background:#adadab;
}

/* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
.main{
  flex:1;
  padding:25px;
}

/* ===== ÙƒØ§Ø±Ø¯ Ø§Ù„Ù…Ù†ØªØ¬ ===== */
.product-card{
  max-width: 750px;
  margin: 0 auto;
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}

.product-card img{
  width: 250px;
  border-radius: 10px;
  display:block;
  margin-bottom:15px;
}

input, textarea, button{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
  border:1px solid #ccc;
}

.save-btn{
  background:#28a745;
  color:white;
  border:none;
  cursor:pointer;
}

.save-btn:hover{
  background:#218838;
}

/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #222;
  color: white;
  text-align: center;
  padding: 20px;
  margin-top: 40px;
}
footer a {
  color: #ffd000;
  text-decoration: none;
  margin: 0 10px;
}
</style>
</head>

<body>

<!-- ========== HEADER ========== -->
<div class="navbar">
  <div class="right-side">
    <img id="storeImg" src="https://via.placeholder.com/45" class="store-img">
    <span id="welcomeText">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„ØªØ§Ø¬Ø±</span>
  </div>

  <div class="left-side">
    <div class="notification-wrapper">
      <a class="notifications" href="notifications.html">ğŸ””</a>
      <span id="notifBadge" class="badge" style="display:none;">0</span>
    </div>
    <a class="logout" href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    <div class="logo">Baro</div>
  </div>
</div>

<div class="layout">

  <!-- ===== SIDEBAR ===== -->
  <div class="sidebar">
    <a href="dashboard.html">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <a href="allorders.html">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
    <a href="settings.html">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
    <a href="addProduct.html">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
  </div>

  <!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== -->
  <div class="main">

    <div class="product-card">
      <h2>ğŸ“¦ Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>

      <img id="productImage" src="" onerror="this.src='https://via.placeholder.com/250'">

      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
      <input id="name">

      <label>Ø§Ù„Ø³Ø¹Ø±</label>
      <input id="price" type="number">

      <label>Ø§Ù„ÙˆØµÙ</label>
      <textarea id="description"></textarea>

      <h3>âœ¨ Ø§Ù„Ù…ÙŠØ²Ø§Øª</h3>
      <div id="featuresBox"></div>

      <button class="save-btn" onclick="saveChanges()">
        ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
      </button>
    </div>

  </div>
</div>

<footer>
  <p>Â© 2026 Baro - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script>
    const token = localStorage.getItem("token");
const merchantId = localStorage.getItem("merchantId");

// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
if (!token || !merchantId) {
  alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  window.location = "login.html";
}

// ===== Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± Ù…Ø«Ù„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø§Øª =====
fetch(`http://localhost:3000/merchants/${merchantId}`, {
  headers: {
    "Authorization": `Bearer ${token}`,
    "Content-Type": "application/json"
  }
})
.then(res => res.json())
.then(merchant => {

  document.getElementById("welcomeText").textContent =
    "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ " + (merchant.name || "Ø§Ù„ØªØ§Ø¬Ø±");

  if (merchant.storeImage) {
    document.getElementById("storeImg").src =
      "http://localhost:3000" + merchant.storeImage;
  }
});

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ productId Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
const params = new URLSearchParams(window.location.search);
const productId = params.get("productId");

if(!productId){
  alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù…Ù†ØªØ¬!");
  window.location = "dashboard.html";
}

// ===== Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬ =====
// ===== Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬ (Ù†Ø³Ø®Ø© Ù…Ø¶Ù…ÙˆÙ†Ø©) =====
fetch(`http://localhost:3000/merchants/${merchantId}/products/${productId}`, {
  headers: { 
    "Authorization": `Bearer ${token}`,
    "Content-Type": "application/json"
  }
})
.then(res => res.json())
.then(data => {

  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ±Ø¬Ù‘Ø¹ Ø§Ù„Ù…Ù†ØªØ¬ Ø¯Ø§Ø®Ù„ ÙƒØ§Ø¦Ù†
  const p = data.product || data;

  document.getElementById("productImage").src =
    "http://localhost:3000" + (p.image || "");

  document.getElementById("name").value = p.name || "";
  document.getElementById("price").value = p.price || "";
  document.getElementById("description").value = p.description || "";

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙŠØ²Ø§Øª
  const featuresBox = document.getElementById("featuresBox");
  featuresBox.innerHTML = "";

  if(p.features && p.features.length > 0){
    p.features.forEach(f => {

      const div = document.createElement("div");
      div.style.border = "1px solid #ddd";
      div.style.padding = "10px";
      div.style.marginBottom = "10px";
      div.style.borderRadius = "8px";

      div.innerHTML = `
        <b>${f.name}</b><br>
        ${f.values.join(" , ")}
      `;

      featuresBox.appendChild(div);
    });
  } else {
    featuresBox.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙŠØ²Ø§Øª.</p>";
  }
});

// Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
function saveChanges(){

  const updated = {
    name: document.getElementById("name").value,
    price: document.getElementById("price").value,
    description: document.getElementById("description").value
  };

  fetch(`http://localhost:3000/products/${productId}`, {
    method: "PUT",
    headers: {
      "Authorization": `Bearer ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify(updated)
  })
  .then(res => res.json())
  .then(r => {
    alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
  })
  .catch(err => {
    alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«");
    console.error(err);
  });
}
// ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª =====
fetch(`http://localhost:3000/merchants/${merchantId}/notifications`)
.then(res => res.json())
.then(notifs => {
  const unread = notifs.filter(n => !n.isRead).length;
  const badge = document.getElementById("notifBadge");

  if(unread > 0){
    badge.style.display = "flex";
    badge.textContent = unread;
  } else {
    badge.style.display = "none";
  }
});

</script>

</body>
</html>
