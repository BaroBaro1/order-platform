<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f9;
  direction:rtl;
}

/* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù†ÙØ³Ù‡) ========== */
.navbar {
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 30px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.right-side{
  display:flex;
  align-items:center;
  gap:10px;
}

.store-img{
  width:45px;
  height:45px;
  border-radius:50%;
  object-fit:cover;
  border:1px solid #ddd;
}
#welcomeText{
  font-weight:bold;
  color:#333;
}
.left-side{
  display:flex;
  align-items:center;
  gap:15px;
}

.notifications{
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
  cursor:pointer;
}

/* ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
.notification-wrapper{
  position: relative;
  display: inline-block;
}

.badge{
  position:absolute;
  top:-5px;
  right:-5px;
  background:red;
  color:white;
  font-size:12px;
  width:18px;
  height:18px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

.logout{
  text-decoration:none;
  color:#ff3366;
  font-weight:bold;
}

.logo{
  font-size:22px;
  font-weight:bold;
  color:#ff3366;
}

/* ========== ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© ========== */
.layout{
  display:flex;
}

/* ========== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ========== */
.sidebar{
  width:230px;
  background:#cbced2;
  min-height:100vh;
  padding-top:20px;
}

.sidebar a{
  display:block;
  color:black;
  text-decoration:none;
  padding:12px 20px;
  margin:5px 10px;
  border-radius:8px;
}

.sidebar a:hover{
  background:#adadab;
}

/* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
.main{
  flex:1;
  padding:25px;
}

/* ===== ÙƒØ§Ø±Ø¯ Ø§Ù„Ù…Ù†ØªØ¬ ===== */
.product-card{
  max-width: 750px;
  margin: 0 auto;
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}

/* ===== ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨) ===== */
.product-img{
  width: 250px;      /* ØµØºÙ‘Ø±Ù†Ø§ Ø§Ù„Ø¹Ø±Ø¶ */
  max-width: 100%;   /* Ø­ØªÙ‰ Ù„Ø§ ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„ÙƒØ§Ø±Ø¯ */
  height: auto;      /* ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø³Ø¨Ø© */
  border-radius: 12px;
  display:block;
  margin: 10px auto; /* ØªÙˆØ³ÙŠØ· Ø§Ù„ØµÙˆØ±Ø© */
}

input, textarea, button{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
  border:1px solid #ccc;
}

.save-btn{
  background:#28a745;
  color:white;
  border:none;
  cursor:pointer;
}

.save-btn:hover{
  background:#218838;
}

/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #222;
  color: white;
  text-align: center;
  padding: 20px;
  margin-top: 40px;
}
footer a {
  color: #ffd000;
  text-decoration: none;
  margin: 0 10px;
}
</style>
</head>

<body>

<!-- ========== HEADER ========== -->
<div class="navbar">
  <div class="right-side">
    <img id="storeImg" src="https://via.placeholder.com/45" class="store-img">
    <span id="welcomeText">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„ØªØ§Ø¬Ø±</span>
  </div>

  <div class="left-side">
    <div class="notification-wrapper">
      <a class="notifications" href="notifications.html">ğŸ””</a>
      <span id="notifBadge" class="badge" style="display:none;">0</span>
    </div>
    <a class="logout" href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    <div class="logo">Baro</div>
  </div>
</div>

<div class="layout">

  <!-- ===== SIDEBAR ===== -->
  <div class="sidebar">
    <a href="dashboard.html">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <a href="allorders.html">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
    <a href="settings.html">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
    <a href="addProduct.html">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
  </div>

  <!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== -->
  <div class="main">

    <div class="product-container">

  <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
  <div class="product-header">
        <button id="editBtn" onclick="enableEdit()">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</button>

    <img id="productImage" src="" class="product-img">
  </div>

  <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
  <div id="viewMode">
    <h2 id="v_name"></h2>
    <p><b>Ø§Ù„ØµÙ†Ù:</b> <span id="v_category"></span></p>
    <p><b>Ø§Ù„Ø³Ø¹Ø±:</b> <span id="v_price"></span> Ø¯Ø¬</p>
    <p><b>Ø§Ù„ÙˆØµÙ:</b></p>
    <p id="v_desc"></p>

    <h3>Ø§Ù„Ù…ÙŠØ²Ø§Øª</h3>
    <div id="v_features"></div>
  </div>

  <!-- ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©) -->
  <div id="editMode" style="display:none">

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
    <input id="e_name">

    <label>Ø§Ù„ØµÙ†Ù</label>
    <input id="e_category">

    <label>Ø§Ù„Ø³Ø¹Ø±</label>
    <input id="e_price">

    <label>Ø§Ù„ÙˆØµÙ</label>
    <textarea id="e_desc"></textarea>

    <h3>Ø§Ù„Ù…ÙŠØ²Ø§Øª</h3>
    <div id="e_features"></div>
<button type="button" onclick="addFeatureField()"
 style="background:#007bff;color:white;border:none;padding:8px;margin-top:6px; border-radius:6px;cursor:pointer;">
â• Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©
</button>
    <button onclick="saveChanges()" class="save-btn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
  </div>

</div>

</div>
</div>
<footer>
  <p>Â© 2026 Baro - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script>
    const token = localStorage.getItem("token");
const merchantId = localStorage.getItem("merchantId");

// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
if (!token || !merchantId) {
  alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  window.location = "login.html";
}

// ===== Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± Ù…Ø«Ù„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø§Øª =====
fetch(`http://localhost:3000/merchants/${merchantId}`, {
  headers: {
    "Authorization": `Bearer ${token}`,
    "Content-Type": "application/json"
  }
})
.then(res => res.json())
.then(merchant => {

  document.getElementById("welcomeText").textContent =
    "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ " + (merchant.name || "Ø§Ù„ØªØ§Ø¬Ø±");

  if (merchant.storeImage) {
    document.getElementById("storeImg").src =
      "http://localhost:3000" + merchant.storeImage;
  }
});

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ productId Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
const params = new URLSearchParams(window.location.search);
const productId = params.get("productId");

if(!productId){
  alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù…Ù†ØªØ¬!");
  window.location = "dashboard.html";
}
// ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
function enableEdit(){
  document.getElementById("viewMode").style.display = "none";
  document.getElementById("editMode").style.display = "block";
}
// Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶
function disableEdit(){
  document.getElementById("viewMode").style.display = "block";
  document.getElementById("editMode").style.display = "none";
}
// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ¹Ø±Ø¶Ù‡Ø§
fetch(`http://localhost:3000/merchants/${merchantId}/products/${productId}`, {
  headers:{ Authorization: `Bearer ${token}` }
})
.then(r=>r.json())
.then(data=>{

  const p = data.product || data;

  // ØµÙˆØ±Ø©
  document.getElementById("productImage").src =
     "http://localhost:3000"+(p.image||"");

  // ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶
  document.getElementById("v_name").textContent = p.name;
  document.getElementById("v_category").textContent = p.category || "â€”";
  document.getElementById("v_price").textContent = p.price;
  document.getElementById("v_desc").textContent = p.description || "";
  document.getElementById("v_features").textContent = p.features ? JSON.stringify(p.features) : "";

  // ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  document.getElementById("e_name").value = p.name;
  document.getElementById("e_category").value = p.category || "";
  document.getElementById("e_price").value = p.price;
  document.getElementById("e_desc").value = p.description || "";
  document.getElementById("e_features").value = JSON.stringify(p.features || []);

  // Ø§Ù„Ù…ÙŠØ²Ø§Øª (Ø¹Ø±Ø¶)
  const vF = document.getElementById("v_features");
  vF.innerHTML="";

  (p.features||[]).forEach(f=>{
    vF.innerHTML += `<p><b>${f.name}:</b> ${f.values.join(" , ")}</p>`;
  });
// Ù…Ù„Ø¡ Ø§Ù„Ù…ÙŠØ²Ø§Øª ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
const eF = document.getElementById("e_features");
eF.innerHTML = "";

(p.features || []).forEach(f=>{
  addFeatureField(f.name, f.values.join(", "));
});

});
function addFeatureField(name = "", values = "") {
  const container = document.getElementById("e_features");

  const div = document.createElement("div");
  div.className = "feature-row";
  div.style.border = "1px solid #ddd";
  div.style.padding = "10px";
  div.style.marginTop = "8px";
  div.style.borderRadius = "8px";

  div.innerHTML = `
    <input placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙŠØ²Ø© (Ù…Ø«Ø§Ù„: Ø§Ù„Ù„ÙˆÙ†)" value="${name}" class="f_name">
    <input placeholder="Ø§Ù„Ù‚ÙŠÙ… Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø© (Ø£Ø­Ù…Ø±, Ø£Ø²Ø±Ù‚)" value="${values}" class="f_values">
    <button type="button" onclick="this.parentElement.remove()" 
      style="background:red;color:white;border:none;padding:6px;margin-top:5px;">
      ğŸ—‘ï¸ Ø­Ø°Ù
    </button>
  `;

  container.appendChild(div);
}

// Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
function saveChanges(){

  const featureRows = document.querySelectorAll(".feature-row");
  let features = [];

  featureRows.forEach(row => {
    const name = row.querySelector(".f_name").value.trim();
    const values = row.querySelector(".f_values").value
                      .split(",")
                      .map(v => v.trim())
                      .filter(v => v !== "");

    if(name && values.length > 0){
      features.push({ name, values });
    }
  });

  const body = {
    name: document.getElementById("e_name").value,
    category: document.getElementById("e_category").value,
    price: document.getElementById("e_price").value,
    description: document.getElementById("e_desc").value,
    features: features
  };

  fetch(`http://localhost:3000/merchants/${merchantId}/products/${productId}`,{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "Authorization":`Bearer ${token}`
    },
    body: JSON.stringify(body)
  })
  .then(r=>r.json())
  .then(()=>{
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…");
    location.reload();
  });
}

// ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª =====
fetch(`http://localhost:3000/merchants/${merchantId}/notifications`)
.then(res => res.json())
.then(notifs => {
  const unread = notifs.filter(n => !n.isRead).length;
  const badge = document.getElementById("notifBadge");

  if(unread > 0){
    badge.style.display = "flex";
    badge.textContent = unread;
  } else {
    badge.style.display = "none";
  }
});

</script>

</body>
</html>
