<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f9;
  direction:rtl;
}

/* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù†ÙØ³Ù‡) ========== */
.navbar {
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 30px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.right-side{
  display:flex;
  align-items:center;
  gap:10px;
}

.store-img{
  width:45px;
  height:45px;
  border-radius:50%;
  object-fit:cover;
  border:1px solid #ddd;
}

#welcomeText{
  font-weight:bold;
  color:#333;
}

.left-side{
  display:flex;
  align-items:center;
  gap:15px;
}

.notifications{
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
  cursor:pointer;
}
/* ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
.notification-wrapper{
  position: relative;
  display: inline-block;
}

.badge{
  position:absolute;
  top:-5px;
  right:-5px;
  background:red;
  color:white;
  font-size:12px;
  width:18px;
  height:18px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

.logout{
  text-decoration:none;
  color:#ff3366;
  font-weight:bold;
}

.logo{
  font-size:22px;
  font-weight:bold;
  color:#ff3366;
}

/* ========== Ø§Ù„ØªØ®Ø·ÙŠØ· ========== */
.layout{
  display:flex;
}

/* ========== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ========== */
.sidebar{
  width:230px;
  background:#e5e7eb;
  min-height:100vh;
  padding-top:20px;
}

.sidebar a{
  display:block;
  color:rgb(14, 12, 12);
  text-decoration:none;
  padding:12px 20px;
  margin:5px 10px;
  border-radius:8px;
}

.sidebar a:hover{
  background:#adadab;
}

.sidebar a.active{
  background:#adadab;
  font-weight:bold;
}

/* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ========== */
.main{
  flex:1;
  padding:25px;
}

.container{
  max-width: 1000px;
  margin: 0 auto;
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}

/* ===== Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙÙ„ØªØ±Ø© ===== */
.filters{
  display:flex;
  gap:10px;
  margin-bottom:15px;
}

.filters button{
  padding:8px 12px;
  border:none;
  border-radius:5px;
  cursor:pointer;
  background:#ddd;
}

.filters button.active{
  background:#007bff;
  color:white;
}

#search{
  padding:8px;
  width:250px;
  border-radius:5px;
  border:1px solid #ccc;
}

/* ===== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ===== */
table{
  width:100%;
  border-collapse:collapse;
}

th, td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}

th{
  background:#f0f0f0;
}

/* Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨ */
.pending{
  color:#ff9800;
  font-weight:bold;
}

.done{
  color:green;
  font-weight:bold;
}

/* Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© */
.update-btn{
  background:#28a745;
  color:white;
  border:none;
  padding:6px 10px;
  border-radius:5px;
  cursor:pointer;
}

/* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© */
#status{
  margin-top:10px;
  color:green;
  text-align:center;
}

/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #222;
  color: white;
  text-align: center;
  padding: 20px;
  margin-top: 40px;
}

footer a {
  color: #ffd000;
  text-decoration: none;
  margin: 0 10px;
}
</style>
</head>

<body>

<!-- ========== HEADER ========== -->
<div class="navbar">
  <div class="right-side">
    <img id="storeImg"
         src="https://via.placeholder.com/45"
         class="store-img">
    <span id="welcomeText">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„ØªØ§Ø¬Ø±</span>
  </div>

  <div class="left-side">
<div class="notification-wrapper">
  <a class="notifications" href="notifications.html">ğŸ””</a>
  <span id="notifBadge" class="badge" style="display:none;">0</span>
</div>   
 <a class="logout" href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    <div class="logo">Baro</div>
  </div>
</div>

<div class="layout">

<!-- ===== SIDEBAR ===== -->
<div class="sidebar">
<a href="dashboard.html">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  <a href="allorders.html" class="active">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
  <a href="settings.html">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
  <a href="addProduct.html">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
</div>

<!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== -->
<div class="main">
<div class="container">

<h2>ğŸ›’ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>

<div class="filters">
  <button id="btnAll" class="active" onclick="filterStatus('all')">Ø§Ù„ÙƒÙ„</button>
  <button id="btnPending" onclick="filterStatus('pending')">Ù…Ø¹Ù„Ù‘Ù‚Ø©</button>
  <button id="btnDone" onclick="filterStatus('done')">Ù…ÙƒØªÙ…Ù„Ø©</button>

  <input id="search" type="text"
   placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ..."
   onkeyup="searchOrders()">
</div>

<table>
  <thead>
    <tr>
      <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
      <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
      <th>Ø§Ù„Ø§Ø³Ù…</th>
      <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
      <th>Ø§Ù„Ø³Ø¹Ø±</th>
      <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
    </tr>
  </thead>

  <tbody id="ordersBody"></tbody>
</table>

<p id="status"></p>

</div>
</div>
</div>

<footer>
  <p>
    <a href="#">Ù…Ù† Ù†Ø­Ù†</a> |
    <a href="#">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
  </p>
  <p>Â© 2026 Baro - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script>
const merchantId = localStorage.getItem("merchantId") || 1;

/* ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± */
fetch(`http://localhost:3000/merchants/${merchantId}`)
.then(r=>r.json())
.then(m=>{
  document.getElementById("welcomeText").textContent =
    "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ " + (m.name || "Ø§Ù„ØªØ§Ø¬Ø±");

  if(m.storeImage){
    document.getElementById("storeImg").src =
      "http://localhost:3000" + m.storeImage;
  }
});

/* ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
let allOrders = [];

fetch(`http://localhost:3000/merchants/${merchantId}/orders`)
.then(r=>r.json())
.then(orders=>{
  allOrders = orders;
  renderTable(orders);
});

function renderTable(orders){
  const body = document.getElementById("ordersBody");
  body.innerHTML = "";

  if(orders.length === 0){
    body.innerHTML = `
      <tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª.</td></tr>`;
    return;
  }

  orders.forEach(o=>{
    const tr = document.createElement("tr");

    const statusClass = o.status === "done" ? "done" : "pending";
    const statusText = o.status === "done" ? "Ù…ÙƒØªÙ…Ù„" : "Ù…Ø¹Ù„Ù‘Ù‚";

    tr.innerHTML = `
      <td>${o.id}</td>
      <td>${o.productName || "â€”"}</td>
      <td>${o.customerName}</td>
      <td>${o.customerPhone}</td>
      <td>${o.totalPrice} Ø¯Ø¬</td>
      <td class="${statusClass}">${statusText}</td>
      <td>
        ${o.status !== "done"
          ? `<button class="update-btn"
             onclick="markDone(${o.id})">
             ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…
           </button>`
          : "â€”"}
      </td>
    `;

    body.appendChild(tr);
  });
}

/* ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© */
function filterStatus(type){
  document.querySelectorAll(".filters button")
    .forEach(b=>b.classList.remove("active"));

  if(type==="all"){
    document.getElementById("btnAll").classList.add("active");
    renderTable(allOrders);
  }
  else if(type==="pending"){
    document.getElementById("btnPending").classList.add("active");
    renderTable(allOrders.filter(o=>o.status!=="done"));
  }
  else{
    document.getElementById("btnDone").classList.add("active");
    renderTable(allOrders.filter(o=>o.status==="done"));
  }
}

/* Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ */
function searchOrders(){
  const q = document.getElementById("search").value.toLowerCase();

  const filtered = allOrders.filter(o =>
    o.customerName.toLowerCase().includes(q) ||
    o.customerPhone.includes(q)
  );

  renderTable(filtered);
}

/* ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ done */
function markDone(orderId){
  fetch(`http://localhost:3000/orders/${orderId}`,{
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({status:"done"})
  })
  .then(r=>r.json())
  .then(()=>{
    document.getElementById("status").textContent =
      "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…";

    // ØªØ­Ø¯ÙŠØ« Ù…Ø­Ù„ÙŠÙ‹Ø§
    allOrders = allOrders.map(o =>
      o.id===orderId ? {...o, status:"done"} : o
    );

    renderTable(allOrders);
  });
}
// ====== Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© ======
fetch(`http://localhost:3000/merchants/${merchantId}/notifications`)
.then(res => res.json())
.then(notifs => {
  const unread = notifs.filter(n => !n.isRead).length;
  const badge = document.getElementById("notifBadge");

  if(unread > 0){
    badge.style.display = "flex";
    badge.textContent = unread;
  } else {
    badge.style.display = "none";
  }
});

</script>
</body>
</html>
