<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f9;
  direction:rtl;
}

/* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù†ÙØ³ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯) ========== */
.navbar {
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 30px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.right-side{
  display:flex;
  align-items:center;
  gap:10px;
}

.store-img{
  width:45px;
  height:45px;
  border-radius:50%;
  object-fit:cover;
  border:1px solid #ddd;
}

#welcomeText{
  font-weight:bold;
  color:#333;
}

.left-side{
  display:flex;
  align-items:center;
  gap:15px;
}

.notifications{
  text-decoration:none;
  font-weight:bold;
  font-size:20px;
  cursor:pointer;
}

/* ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ===== */
.notification-wrapper{
  position: relative;
  display: inline-block;
}

.badge{
  position:absolute;
  top:-5px;
  right:-5px;
  background:red;
  color:white;
  font-size:12px;
  width:18px;
  height:18px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

.logout{
  text-decoration:none;
  color:#ff3366;
  font-weight:bold;
}

.logo{
  font-size:22px;
  font-weight:bold;
  color:#ff3366;
}

/* ========== ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© ========== */
.layout{
  display:flex;
}

/* ========== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ========== */
.sidebar{
  width:230px;
  background:#cbced2;
  min-height:100vh;
  padding-top:20px;
}

.sidebar a{
  display:block;
  color:rgb(14, 12, 12);
  text-decoration:none;
  padding:12px 20px;
  margin:5px 10px;
  border-radius:8px;
}

.sidebar a:hover{
  background:#adadab;
}

.sidebar a.active{
  background:#adadab;
  font-weight:bold;
}

/* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
.main{
  flex:1;
  padding:25px;
}

/* ===== Ø§Ù„ÙÙˆØ±Ù… (Ù…Ø­Ø³Ù‘Ù† + Ù…ØªÙ†Ø§Ø³Ù‚) ===== */
.form-box {
  max-width: 650px;
  margin: 0 auto;
  background:white;
  padding:25px;
  border-radius:10px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}

.form-box h2{
  text-align:center;
}

input, textarea, button {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 5px;
  border: 1px solid #ccc;
}

button {
  background:#007bff;
  color:white;
  border:none;
  cursor:pointer;
}

button:hover{
  background:#0056b3;
}

#preview {
  max-width: 100%;
  max-height: 220px;
  margin-top: 10px;
  border-radius: 8px;
  display:none;
}

/* ===== Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #222;
  color: white;
  text-align: center;
  padding: 20px;
  margin-top: 40px;
}

footer a {
  color: #ffd000;
  text-decoration: none;
  margin: 0 10px;
}
</style>
</head>

<body>

<!-- ========== HEADER ========== -->
<div class="navbar">

  <div class="right-side">
    <img id="storeImg"
         src="https://via.placeholder.com/45"
         class="store-img">
    <span id="welcomeText">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„ØªØ§Ø¬Ø±</span>
  </div>

  <div class="left-side">
    <div class="notification-wrapper">
      <a class="notifications" href="notifications.html">ğŸ””</a>
      <span id="notifBadge" class="badge" style="display:none;">0</span>
    </div>

    <a class="logout" href="login.html"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    <div class="logo">Baro</div>
  </div>

</div>

<!-- ========== ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© ========== -->
<div class="layout">

  <!-- ===== SIDEBAR ===== -->
  <div class="sidebar">
    <a href="dashboard.html">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <a href="allorders.html">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
    <a href="settings.html">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
    <a href="addProduct.html" class="active">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
  </div>

  <!-- ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== -->
  <div class="main">

    <div class="form-box">
      <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>

      <form id="addProductForm" enctype="multipart/form-data">

        <!-- Ù†Ø¶Ø¹Ù‡ Ù…Ø®ÙÙŠ ÙˆÙŠÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ -->
        <input type="hidden" name="merchantId" id="merchantIdField">

        <input type="text" name="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required />
        <input type="text" name="category" placeholder="Ø§Ù„ÙØ¦Ø©" required />
        <input type="number" name="price" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬)" required />
        <textarea name="description" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬"></textarea>

        <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬:</label>
        <input type="file" name="image" accept="image/*" id="imageInput" />
        <img id="preview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©" />
<h3>âœ¨ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>

<div id="featuresBox"></div>

<button type="button" onclick="addFeatureField()">
  â• Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©
</button>

<br><br>

        <button type="submit">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
      </form>
    </div>

  </div>
</div>

<script>
const merchantId = localStorage.getItem("merchantId");
const token = localStorage.getItem("token");

if (!merchantId || !token) {
  alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  window.location = "login.html";
}
document.getElementById("merchantIdField").value = merchantId;

// ===== Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± (Ù…Ø«Ù„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯) =====
fetch(`http://localhost:3000/merchants/${merchantId}`
, {
  headers: {
     "Authorization": `Bearer ${token}` 
    ,  "Content-Type": "application/json"}
}
)
.then(res => res.json())
.then(merchant => {
  document.getElementById("welcomeText").textContent =
    "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ " + (merchant.name || "Ø§Ù„ØªØ§Ø¬Ø±");

  if(merchant.storeImage){
    document.getElementById("storeImg").src =
      "http://localhost:3000" + merchant.storeImage;
  }
});

// ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª =====
fetch(`http://localhost:3000/merchants/${merchantId}/notifications`)
.then(res => res.json())
.then(notifs => {
  const unread = notifs.filter(n => !n.isRead).length;
  const badge = document.getElementById("notifBadge");

  if(unread > 0){
    badge.style.display = "flex";
    badge.textContent = unread;
  } else {
    badge.style.display = "none";
  }
});

// ===== Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© =====
const form = document.getElementById("addProductForm");
const imageInput = document.getElementById("imageInput");
const preview = document.getElementById("preview");

imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (file) {
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
  } else {
    preview.style.display = "none";
  }
});

// ===== Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬ =====
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(form);

  // Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª
  const features = collectFeatures();

  // Ø¥Ø¶Ø§ÙØªÙ‡Ø§ ÙƒÙ€ JSON Ø¯Ø§Ø®Ù„ Ø§Ù„ÙÙˆØ±Ù…
  formData.append("features", JSON.stringify(features));

  try {
    const response = await fetch("http://localhost:3000/products", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    if (data.success) {
      alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!");
      window.location = "dashboard.html";
    } else {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
    }
  } catch (err) {
    console.error(err);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
  }
});
// ===== Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙŠØ²Ø§Øª ÙˆØ§Ù„Ù‚ÙŠÙ… Ø¨Ø´ÙƒÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ =====
let featureIndex = 0;

function addFeatureField(){
  const box = document.getElementById("featuresBox");

  const div = document.createElement("div");
  div.style.border = "1px solid #ddd";
  div.style.padding = "10px";
  div.style.marginBottom = "10px";
  div.style.borderRadius = "8px";

  div.innerHTML = `
    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙŠØ²Ø© (Ù…Ø«Ø§Ù„: Ø§Ù„Ù„ÙˆÙ†)" id="featureName_${featureIndex}">

    <div id="valuesBox_${featureIndex}"></div>

    <button type="button" onclick="addValueField(${featureIndex})">
      â• Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙ…Ø©
    </button>

    <button type="button" onclick="this.parentElement.remove()"
      style="background:red;color:white;margin-right:10px;">
      âŒ Ø­Ø°Ù Ø§Ù„Ù…ÙŠØ²Ø©
    </button>
  `;

  box.appendChild(div);

  // Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù‚ÙŠÙ…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  addValueField(featureIndex);

  featureIndex++;
}

function addValueField(index){
  const valuesBox = document.getElementById(`valuesBox_${index}`);

  const input = document.createElement("input");
  input.placeholder = "Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ÙŠØ²Ø© (Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø±)";
  input.className = "featureValue";
  input.style.display = "block";
  input.style.marginTop = "5px";

  valuesBox.appendChild(input);
}
function collectFeatures(){
  const features = [];

  document.querySelectorAll("#featuresBox > div").forEach(featureDiv => {
    const featureName = featureDiv.querySelector("input[type='text']").value;

    const values = [];
    featureDiv.querySelectorAll(".featureValue").forEach(inp => {
      if(inp.value.trim() !== "") values.push(inp.value);
    });

    if(featureName && values.length > 0){
      features.push({
        name: featureName,
        values: values
      });
    }
  });

  return features;
}

</script>

<footer>
  <p>
    <a href="#">Ù…Ù† Ù†Ø­Ù†</a> |
    <a href="#">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
  </p>
  <p>Â© 2026 Baro - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

</body>
</html>
