<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>إضافة منتج جديد</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
  form { background: #fff; padding: 20px; border-radius: 8px; max-width: 500px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  input, textarea, button { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; }
  button { background-color: #007bff; color: white; border: none; cursor: pointer; }
  button:hover { background-color: #0056b3; }
  #preview { max-width: 100%; max-height: 200px; margin-top: 10px; border-radius: 5px; }
</style>
</head>
<body>

<h2 style="text-align:center;">إضافة منتج جديد</h2>

<form id="addProductForm" enctype="multipart/form-data">
  <input type="text" name="merchantId" placeholder="ID التاجر" required />
  <input type="text" name="name" placeholder="اسم المنتج" required />
  <input type="text" name="category" placeholder="الفئة" required />
  <input type="number" name="price" placeholder="السعر" required />
  <textarea name="description" placeholder="وصف المنتج"></textarea>
  
  <label>صورة المنتج:</label>
  <input type="file" name="image" accept="image/*" id="imageInput" />
  <img id="preview" src="" alt="معاينة الصورة" style="display:none;" />

  <button type="submit">إضافة المنتج</button>
</form>

<script>
const form = document.getElementById("addProductForm");
const imageInput = document.getElementById("imageInput");
const preview = document.getElementById("preview");

// عرض معاينة الصورة فور اختيارها
imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (file) {
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
  } else {
    preview.src = "";
    preview.style.display = "none";
  }
});

// إرسال المنتج مع الصورة
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(form);

  try {
    const response = await fetch("http://localhost:3000/products", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    if (data.success) {
      alert("تم إضافة المنتج بنجاح!");
      form.reset();
      preview.style.display = "none";
    } else {
      alert("حدث خطأ أثناء الإضافة");
    }
  } catch (err) {
    console.error(err);
    alert("حدث خطأ في الاتصال بالسيرفر");
  }
});
</script>

</body>
</html>
