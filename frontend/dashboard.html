<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ§Ø¬Ø±</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f9;
  direction:rtl;
}

/* ========== HEADER ========== */
.navbar {
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 30px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}
.right-side{display:flex;align-items:center;gap:10px;}
.store-img{width:45px;height:45px;border-radius:50%;object-fit:cover;border:1px solid #ddd;}
#welcomeText{font-weight:bold;color:#333;}
.left-side{display:flex;align-items:center;gap:15px;}
.notifications{text-decoration:none;font-weight:bold;font-size:20px;cursor:pointer;}
.notification-wrapper{position: relative;display: inline-block;}
.badge{position:absolute;top:-5px;right:-5px;background:red;color:white;font-size:12px;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;}
.logout{text-decoration:none;color:#ff3366;font-weight:bold;}
.logo{font-size:22px;font-weight:bold;color:#ff3366;}

/* ========== LAYOUT ========== */
.layout{display:flex;}

/* ========== SIDEBAR ========== */
.sidebar{width:230px;background:#cbced2;min-height:100vh;padding-top:20px;}
.sidebar a{display:block;color:black;text-decoration:none;padding:12px 20px;margin:5px 10px;border-radius:8px;}
.sidebar a:hover{background:#adadab;}
.sidebar a.active{background:#adadab;font-weight:bold;}

/* ========== MAIN ========== */
.main{flex:1;padding:25px;}
.container{max-width: 900px;margin: 0 auto;background:white;padding:20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.1);} 

/* ===== STATS ===== */
.stats-grid{display:grid;grid-template-columns: repeat(4, 1fr);gap:15px;margin-bottom:20px;}
.stat-card{background:white;padding:15px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1);text-align:center;}
.stat-title{color:#666;font-size:14px;}
.stat-value{font-size:22px;font-weight:bold;margin-top:5px;}

/* ===== PRODUCTS ===== */
.top-actions{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}
.add-btn{background:#007bff;color:white;padding:8px 12px;border-radius:5px;text-decoration:none;font-size:14px;}
.product{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #ddd;padding:10px 0;}
.product img{width:80px;height:80px;object-fit:cover;border-radius:8px;}
.info{flex:1;margin-left:15px;}
button{margin-left:10px;padding:8px 12px;border:none;border-radius:5px;cursor:pointer;}
.copy{background:#007bff;color:white;}
.orders{background:#28a745;color:white;}
#status{text-align:center;margin-top:10px;color:green;}

/* ===== FOOTER ===== */
footer{background:#222;color:white;text-align:center;padding:20px;margin-top:40px;}
footer a{color:#ffd000;text-decoration:none;margin:0 10px;}
</style>
</head>
<body>

<!-- HEADER -->
<div class="navbar">
  <div class="right-side">
    <img id="storeImg" src="https://via.placeholder.com/45" class="store-img">
    <span id="welcomeText">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø§Ù„ØªØ§Ø¬Ø±</span>
  </div>

  <div class="left-side">
    <div class="notification-wrapper">
      <a class="notifications" href="notifications.html">ğŸ””</a>
      <span id="notifBadge" class="badge" style="display:none;">0</span>
    </div>
    <a class="logout" href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    <div class="logo">Baro</div>
  </div>
</div>

<div class="layout">
  <!-- SIDEBAR -->
  <div class="sidebar">
    <a href="dashboard.html" class="active">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
    <a href="allorders.html">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
    <a href="settings.html">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
    <a href="addProduct.html">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
  </div>

  <div class="main">
    <h3>ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ù…ØªØ¬Ø±Ùƒ</h3>

    <div class="stats-grid">
      <div class="stat-card"><div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div><div class="stat-value" id="totalOrders">0</div></div>
      <div class="stat-card"><div class="stat-title">Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‘Ù‚Ø©</div><div class="stat-value" id="pendingOrders">0</div></div>
      <div class="stat-card"><div class="stat-title">Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div><div class="stat-value" id="doneOrders">0</div></div>
      <div class="stat-card"><div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div><div class="stat-value" id="totalRevenue">0 Ø¯Ø¬</div></div>
    </div>

    <div class="container">
      <div class="top-actions">
        <div>
          <h2>ğŸ“¦ Ù…Ù†ØªØ¬Ø§ØªÙŠ</h2>
          <p>Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ØªØ§Ø¬Ø±: <b id="merchantLabel"></b></p>
        </div>
        <a class="add-btn" href="addProduct.html">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</a>
      </div>

      <div id="products"> </div>
      <p id="status"> </p>
    </div>
  </div>
 
</div>

<footer>
  <p><a href="#">Ù…Ù† Ù†Ø­Ù†</a> | <a href="#">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a></p>
  <p>Â© 2026 Baro - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
</footer>

<script>
const merchantId = localStorage.getItem("merchantId");
const token = localStorage.getItem("token");

if (!merchantId || !token) {
  alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  window.location = "login.html";
}

document.getElementById("merchantLabel").textContent = merchantId;

// ===== Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø§Ùƒâ€ŒØ§Ù†Ø¯ =====
fetch(`http://localhost:3000/merchants/${merchantId}/stats`, {
  headers: { "Authorization": `Bearer ${token}` }
})
.then(res => res.json())
.then(stats => {
  document.getElementById("totalOrders").textContent = stats.totalOrders;
  document.getElementById("pendingOrders").textContent = stats.pendingOrders;
  document.getElementById("doneOrders").textContent = stats.doneOrders;
  document.getElementById("totalRevenue").textContent = stats.totalRevenue + " Ø¯Ø¬";
});

// ===== Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø¬Ø± =====
fetch(`http://localhost:3000/merchants/${merchantId}`, {
  headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` }
})
.then(res => res.json())
.then(merchant => {
  document.getElementById("welcomeText").textContent = "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ " + (merchant.name || "Ø§Ù„ØªØ§Ø¬Ø±");
  if(merchant.storeImage){
    document.getElementById("storeImg").src = "http://localhost:3000" + merchant.storeImage;
  }
});

// ===== Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª =====
fetch(`http://localhost:3000/merchants/${merchantId}/products`, {
  headers: { "Authorization": `Bearer ${token}` }
})
.then(res => res.json())
.then(products => {
  const box = document.getElementById("products");
  box.innerHTML = " ";

  if (products.length === 0) {
    box.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯.</p>";
    return;
  }

  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "product";

    const link = `http://localhost:3000/order.html?link=${p.orderLink}`;

    div.innerHTML = `
      <img src="http://localhost:3000${p.image || ''}" onerror="this.src='https://via.placeholder.com/80'">
       <div class="info"> <b>${p.name} </b> <br> ${p.price} Ø¯Ø¬ </div>
      <div>
        <button class="copy" onclick="copyLink('${link}')">Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨</button>
        <button class="orders" onclick="window.location='orders.html?productId=${p.id}'">Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        <button class="copy" onclick="window.location='product.html?productId=${p.id}'">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬</button>
        </div>
    `;
    box.appendChild(div);
  });
});

function copyLink(text){
  navigator.clipboard.writeText(text);
  document.getElementById("status").textContent = "ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­ âœ…";
}

// ===== Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª =====
fetch(`http://localhost:3000/merchants/${merchantId}/notifications`, {
  headers: { "Authorization": `Bearer ${token}` }
})
.then(res => res.json())
.then(notifs => {
  const unread = notifs.filter(n => !n.isRead).length;
  const badge = document.getElementById("notifBadge");
  if(unread > 0){ badge.style.display = "flex"; badge.textContent = unread; }
  else { badge.style.display = "none"; }
});

</script>
</body>
</html>
